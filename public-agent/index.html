<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>404AI - –í–∞—à –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç—É–∞–ª—å–Ω—ã–π –ø–æ–º–æ—â–Ω–∏–∫</title>
    <link rel="stylesheet" href="../shared/styles.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        .hero-section {
            text-align: center;
            padding: 4rem 2rem;
            position: relative;
        }
        
        .hero-title {
            font-size: 3.5rem;
            font-weight: 700;
            background: var(--gradient-1);
            background-clip: text;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 1rem;
            animation: fadeIn 1s ease-out, float 3s ease-in-out infinite;
            text-shadow: 0 0 30px rgba(99, 102, 241, 0.3);
        }
        
        .hero-subtitle {
            font-size: 1.25rem;
            color: var(--text-secondary);
            margin-bottom: 3rem;
            animation: fadeIn 1s ease-out 0.2s both;
        }
        
        .chat-container {
            max-width: 800px;
            margin: 0 auto;
            height: 500px;
            display: flex;
            flex-direction: column;
            animation: fadeIn 1s ease-out 0.4s both;
            position: relative;
        }
        
        .chat-container::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(99, 102, 241, 0.1) 0%, transparent 70%);
            animation: pulse 4s ease-in-out infinite;
            pointer-events: none;
        }
        
        .messages-area {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
            background: rgba(15, 23, 42, 0.4);
            border-radius: 20px 20px 0 0;
            border: 1px solid var(--border-color);
            border-bottom: none;
            position: relative;
            z-index: 1;
        }
        
        .input-area {
            background: var(--glass-morphism-enhanced);
            backdrop-filter: blur(25px);
            border: 1px solid rgba(99, 102, 241, 0.3);
            border-radius: 0 0 20px 20px;
            padding: 20px;
            display: flex;
            gap: 12px;
            position: relative;
            z-index: 1;
            box-shadow: 0 -10px 30px rgba(0, 0, 0, 0.2);
        }
        
        .message-input {
            flex: 1;
            background: rgba(15, 23, 42, 0.6);
            border: 1px solid rgba(99, 102, 241, 0.3);
            border-radius: 12px;
            padding: 12px 16px;
            color: var(--text-primary);
            font-size: 16px;
            transition: all 0.3s ease;
        }
        
        .message-input:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
            background: rgba(15, 23, 42, 0.8);
        }
        
        .send-button {
            padding: 12px 24px;
            background: var(--gradient-1);
            border: none;
            border-radius: 12px;
            color: white;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
            box-shadow: 0 4px 15px rgba(99, 102, 241, 0.3);
        }
        
        .send-button:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(99, 102, 241, 0.4);
        }
        
        .send-button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .typing-indicator {
            display: none;
            align-items: center;
            gap: 8px;
            padding: 16px;
            color: var(--text-secondary);
            font-style: italic;
        }
        
        .typing-indicator.active {
            display: flex;
        }
        
        .loading-animation {
            display: none;
            justify-content: center;
            align-items: center;
            padding: 40px;
        }
        
        .loading-animation.active {
            display: flex;
        }
        
        .ai-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            margin-right: 12px;
        }
        
        .welcome-message {
            text-align: center;
            padding: 40px;
            color: var(--text-secondary);
        }
        
        .welcome-icon {
            font-size: 3rem;
            margin-bottom: 16px;
        }
        
        .mode-indicator {
            position: absolute;
            top: 20px;
            right: 20px;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 0.875rem;
            font-weight: 600;
            background: rgba(16, 185, 129, 0.1);
            border: 1px solid var(--success-color);
            color: var(--success-color);
        }
        
        .mode-indicator.auto {
            background: rgba(245, 158, 11, 0.1);
            border-color: var(--warning-color);
            color: var(--warning-color);
        }
        
        .chat-controls {
            display: flex;
            gap: 12px;
            margin-bottom: 2rem;
            justify-content: center;
            animation: fadeIn 1s ease-out 0.3s both;
        }
        
        @media (max-width: 768px) {
            .hero-title {
                font-size: 2.5rem;
            }
            
            .chat-container {
                height: 400px;
            }
            
            .input-area {
                flex-direction: column;
            }
            
            .send-button {
                width: 100%;
                justify-content: center;
            }
        }
    </style>
</head>
<body>
    <div class="hero-section">
        <h1 class="hero-title">404AI</h1>
        <p class="hero-subtitle">–í–∞—à –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç—É–∞–ª—å–Ω—ã–π –ø–æ–º–æ—â–Ω–∏–∫ 24/7</p>
        
        <div class="chat-controls">
            <button class="btn btn-secondary" id="clearChatBtn">
                üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç—å —á–∞—Ç
            </button>
            <button class="btn btn-secondary" id="newChatBtn">
                ‚ú® –ù–æ–≤—ã–π —á–∞—Ç
            </button>
        </div>
        
        <div class="chat-container glass-morphism">
            <div class="messages-area" id="messagesArea">
                <div class="welcome-message">
                    <div class="welcome-icon">üëã</div>
                    <h3>–ü—Ä–∏–≤–µ—Ç! –Ø 404AI</h3>
                    <p>–ó–∞–¥–∞–π—Ç–µ –º–Ω–µ –ª—é–±–æ–π –≤–æ–ø—Ä–æ—Å, –∏ —è –ø–æ—Å—Ç–∞—Ä–∞—é—Å—å –ø–æ–º–æ—á—å!</p>
                </div>
            </div>
            
            <div class="typing-indicator" id="typingIndicator">
                <div class="ai-avatar">AI</div>
                <div class="loading-dots">
                    <span></span>
                    <span></span>
                    <span></span>
                </div>
                <span>–ò–ò –ø–µ—á–∞—Ç–∞–µ—Ç...</span>
            </div>
            
            <div class="loading-animation" id="loadingAnimation">
                <div class="loading-dots">
                    <span></span>
                    <span></span>
                    <span></span>
                </div>
            </div>
            
            <div class="input-area">
                <input 
                    type="text" 
                    class="message-input" 
                    id="messageInput" 
                    placeholder="–í–≤–µ–¥–∏—Ç–µ –≤–∞—à–µ —Å–æ–æ–±—â–µ–Ω–∏–µ..."
                    maxlength="2000"
                >
                <button class="send-button" id="sendButton">
                    <span>–û—Ç–ø—Ä–∞–≤–∏—Ç—å</span>
                    <span>üöÄ</span>
                </button>
            </div>
        </div>
    </div>
    
    <script src="../shared/config.js"></script>
    <script src="../shared/bridge.js"></script>
    <script>
        class PublicAgent {
            constructor() {
                this.messagesArea = document.getElementById('messagesArea');
                this.messageInput = document.getElementById('messageInput');
                this.sendButton = document.getElementById('sendButton');
                this.typingIndicator = document.getElementById('typingIndicator');
                this.loadingAnimation = document.getElementById('loadingAnimation');
                this.modeIndicator = document.getElementById('modeIndicator');
                
                this.bridge = BridgeUtils.getBridge();
                this.currentMode = this.bridge.getMode();
                this.messages = Utils.loadFromStorage(CONFIG.STORAGE_KEYS.MESSAGES, []);
                
                this.init();
            }
            
            init() {
                this.setupEventListeners();
                this.setupBridgeListeners();
                this.updateModeIndicator();
                this.renderMessages();
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–µ–∂–∏–º –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
                if (this.currentMode === CONFIG.MODES.AUTO) {
                    this.showWelcomeMessage('–Ø –≤ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–º —Ä–µ–∂–∏–º–µ! –û—Ç–≤–µ—á–∞—é –Ω–∞ –≤—Å–µ –≤–æ–ø—Ä–æ—Å—ã —Å–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω–æ.');
                }
            }
            
            setupEventListeners() {
                this.sendButton.addEventListener('click', () => this.sendMessage());
                this.messageInput.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter' && !e.shiftKey) {
                        e.preventDefault();
                        this.sendMessage();
                    }
                });
                
                // –ö–Ω–æ–ø–∫–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —á–∞—Ç–æ–º
                document.getElementById('clearChatBtn').addEventListener('click', () => this.clearChat());
                document.getElementById('newChatBtn').addEventListener('click', () => this.newChat());
                
                // –ì–æ—Ä—è—á–∏–µ –∫–ª–∞–≤–∏—à–∏ –¥–ª—è –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è —Ä–µ–∂–∏–º–∞
                document.addEventListener('keydown', (e) => {
                    if (e.ctrlKey && e.shiftKey && e.key === 'M') {
                        this.toggleMode();
                    }
                });
            }
            
            setupBridgeListeners() {
                // –°–ª—É—à–∞–µ–º –æ—Ç–≤–µ—Ç—ã –æ—Ç –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ –∞–≥–µ–Ω—Ç–∞ —á–µ—Ä–µ–∑ storage events
                this.bridge.on('newResponses', (responses) => {
                    if (responses.length > 0) {
                        const latestResponse = responses[0];
                        this.handleResponse(latestResponse);
                    }
                });
                
                // –°–ª—É—à–∞–µ–º –æ—Ç–≤–µ—Ç—ã —á–µ—Ä–µ–∑ –∫–∞—Å—Ç–æ–º–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è
                window.addEventListener('newResponse', (e) => {
                    this.handleResponse(e.detail);
                });
                
                // –°–ª—É—à–∞–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ä–µ–∂–∏–º–∞
                this.bridge.on('modeChange', (mode) => {
                    this.currentMode = mode;
                    this.updateModeIndicator();
                    
                    const modeText = mode === CONFIG.MODES.AUTO 
                        ? '–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–º —Ä–µ–∂–∏–º–µ' 
                        : '—Ä—É—á–Ω–æ–º —Ä–µ–∂–∏–º–µ';
                    
                    Utils.showNotification(`–ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–æ –≤ ${modeText}`, 'info');
                });
            }
            
            async sendMessage() {
                const message = this.messageInput.value.trim();
                if (!message) return;
                
                // –î–æ–±–∞–≤–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                this.addMessage(message, 'user');
                this.messageInput.value = '';
                this.sendButton.disabled = true;
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –Ω–∞–±–æ—Ä–∞ –¥–ª—è –≤—Å–µ—Ö —Ä–µ–∂–∏–º–æ–≤
                this.showTypingIndicator();
                
                try {
                    let response;
                    
                    if (this.currentMode === CONFIG.MODES.AUTO) {
                        // –ê–≤—Ç–æ-—Ä–µ–∂–∏–º - –≥–µ–Ω–µ—Ä–∏—Ä—É–µ–º –æ—Ç–≤–µ—Ç —Å –∑–∞–¥–µ—Ä–∂–∫–æ–π
                        response = await this.generateAutoResponse(message);
                        this.hideTypingIndicator();
                        this.addMessage(response, 'ai');
                    } else {
                        // –†—É—á–Ω–æ–π —Ä–µ–∂–∏–º - –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º –Ω–∞ –ª–æ–∫–∞–ª—å–Ω—ã–π –∞–≥–µ–Ω—Ç
                        await this.sendToLocalAgent(message);
                        // –û—Ç–≤–µ—Ç –ø—Ä–∏–¥–µ—Ç —á–µ—Ä–µ–∑ handleResponse
                    }
                    
                } catch (error) {
                    console.error('Error sending message:', error);
                    this.hideTypingIndicator();
                    this.addMessage('–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.', 'ai');
                }
                
                this.sendButton.disabled = false;
            }
            
            async generateAutoResponse(userMessage) {
                // –ò–º–∏—Ç–∞—Ü–∏—è "–¥—É–º–∞–Ω–∏—è"
                await new Promise(resolve => setTimeout(resolve, 1000 + Math.random() * 2000));
                
                // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –∫–∞—Ç–µ–≥–æ—Ä–∏—é –∏ –ø–æ–ª—É—á–∞–µ–º –æ—Ç–≤–µ—Ç
                const category = Utils.categorizeMessage(userMessage);
                const response = Utils.getRandomResponse(category, userMessage);
                
                return response;
            }
            
            async sendToLocalAgent(message) {
                // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ —á–µ—Ä–µ–∑ –º–æ—Å—Ç
                const messageId = this.bridge.sendMessage(message);
                
                // –ü—Ä–æ—Å—Ç–æ –∂–¥–µ–º –æ—Ç–≤–µ—Ç–∞ –æ—Ç –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ –∞–≥–µ–Ω—Ç–∞ –±–µ–∑ –∑–∞–≥–ª—É—à–∫–∏
                // –ê–Ω–∏–º–∞—Ü–∏—è "–ò–ò –ø–µ—á–∞—Ç–∞–µ—Ç" –±—É–¥–µ—Ç –ø—Ä–æ–¥–æ–ª–∂–∞—Ç—å—Å—è
                return null;
            }
            
            handleResponse(response) {
                // –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –æ—Ç–≤–µ—Ç –æ—Ç –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ –∞–≥–µ–Ω—Ç–∞
                this.hideTypingIndicator();
                this.addMessage(response.text, 'ai');
                
                Utils.showNotification('üì® –ü–æ–ª—É—á–µ–Ω –æ—Ç–≤–µ—Ç –æ—Ç –æ–ø–µ—Ä–∞—Ç–æ—Ä–∞', 'success');
            }
            
            addMessage(text, sender) {
                const message = {
                    id: Utils.generateId(),
                    text: text,
                    sender: sender,
                    timestamp: new Date()
                };
                
                this.messages.push(message);
                this.saveMessages();
                this.renderMessage(message);
                
                // –ü—Ä–æ–∫—Ä—É—Ç–∫–∞ –≤–Ω–∏–∑
                this.messagesArea.scrollTop = this.messagesArea.scrollHeight;
            }
            
            renderMessage(message) {
                const messageDiv = document.createElement('div');
                messageDiv.className = `message message-${message.sender} fade-in`;
                
                const timeDiv = document.createElement('div');
                timeDiv.style.fontSize = '0.75rem';
                timeDiv.style.opacity = '0.7';
                timeDiv.style.marginTop = '4px';
                timeDiv.textContent = Utils.formatTime(message.timestamp);
                
                messageDiv.innerHTML = `
                    <div>${message.text}</div>
                `;
                messageDiv.appendChild(timeDiv);
                
                this.messagesArea.appendChild(messageDiv);
            }
            
            renderMessages() {
                // –£–¥–∞–ª—è–µ–º –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –µ—Å–ª–∏ –µ—Å—Ç—å —Å–æ–æ–±—â–µ–Ω–∏—è
                const welcomeMsg = this.messagesArea.querySelector('.welcome-message');
                if (welcomeMsg && this.messages.length > 0) {
                    welcomeMsg.remove();
                }
                
                this.messages.forEach(message => this.renderMessage(message));
            }
            
            showTypingIndicator() {
                this.typingIndicator.classList.add('active');
                this.messagesArea.scrollTop = this.messagesArea.scrollHeight;
            }
            
            hideTypingIndicator() {
                this.typingIndicator.classList.remove('active');
            }
            
            showWelcomeMessage(text) {
                const welcomeDiv = document.createElement('div');
                welcomeDiv.className = 'welcome-message';
                welcomeDiv.innerHTML = `
                    <div class="welcome-icon">‚ÑπÔ∏è</div>
                    <p>${text}</p>
                `;
                this.messagesArea.appendChild(welcomeDiv);
            }
            
            toggleMode() {
                this.currentMode = this.currentMode === CONFIG.MODES.MANUAL 
                    ? CONFIG.MODES.AUTO 
                    : CONFIG.MODES.MANUAL;
                
                // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ä–µ–∂–∏–º —á–µ—Ä–µ–∑ –º–æ—Å—Ç
                this.bridge.setMode(this.currentMode);
                this.updateModeIndicator();
                
                const modeText = this.currentMode === CONFIG.MODES.AUTO 
                    ? '–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–º —Ä–µ–∂–∏–º–µ' 
                    : '—Ä—É—á–Ω–æ–º —Ä–µ–∂–∏–º–µ';
                
                Utils.showNotification(`–ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–æ –≤ ${modeText}`, 'success');
            }
            
            updateModeIndicator() {
                if (this.currentMode === CONFIG.MODES.AUTO) {
                    this.modeIndicator.textContent = 'ü§ñ –ê–≤—Ç–æ-—Ä–µ–∂–∏–º';
                    this.modeIndicator.classList.add('auto');
                } else {
                    this.modeIndicator.textContent = 'üë®‚Äçüíª –†—É—á–Ω–æ–π —Ä–µ–∂–∏–º';
                    this.modeIndicator.classList.remove('auto');
                }
            }
            
            saveMessages() {
                Utils.saveToStorage(CONFIG.STORAGE_KEYS.MESSAGES, this.messages);
            }
            
            clearChat() {
                if (confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –æ—á–∏—Å—Ç–∏—Ç—å —á–∞—Ç?')) {
                    this.messages = [];
                    this.saveMessages();
                    this.renderMessages();
                    Utils.showNotification('üóëÔ∏è –ß–∞—Ç –æ—á–∏—â–µ–Ω', 'success');
                }
            }
            
            newChat() {
                this.messages = [];
                this.saveMessages();
                this.renderMessages();
                this.showWelcomeMessage('–ù–æ–≤—ã–π —á–∞—Ç —Å–æ–∑–¥–∞–Ω! –ó–∞–¥–∞–π—Ç–µ –º–Ω–µ –ª—é–±–æ–π –≤–æ–ø—Ä–æ—Å.');
                Utils.showNotification('‚ú® –ù–æ–≤—ã–π —á–∞—Ç —Å–æ–∑–¥–∞–Ω', 'success');
            }
        }
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        document.addEventListener('DOMContentLoaded', () => {
            new PublicAgent();
        });
    </script>
</body>
</html>
